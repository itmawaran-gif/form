<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MAWARAN CO</title>

<style>
body{font-family:tahoma;background:#f2f4f7;margin:0}
.container{max-width:420px;margin:auto;background:#fff;
padding:16px;border-radius:12px;box-shadow:0 4px 10px #0002}
h2{text-align:center}
label{display:block;margin-top:10px;font-weight:bold}
input,select,textarea,button{
width:100%;padding:10px;margin-top:4px;
border-radius:8px;border:1px solid #ccc;font-size:16px}
input.error,select.error,textarea.error{border-color:red;background:#ffecec}
button{background:#0a7cff;color:#fff;border:0;margin-top:15px}
#topInfo{background:#eef;padding:10px;border-radius:8px;margin-bottom:10px}
#msg{text-align:center;margin-top:10px;font-weight:bold}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<!-- تسجيل الدخول -->
<div id="login">
  <h2>تسجيل الدخول</h2>
  <label>اسم المندوب *</label>
  <input id="repName">
  <label>المدينة *</label>
  <input id="city">
  <button onclick="saveLogin()">دخول</button>
</div>

<!-- الفورم -->
<div id="formBox" class="hidden">

  <div id="topInfo">
    <div>المندوب: <b id="repShow"></b></div>
    <div>
      المدينة:
      <input id="cityEdit">
    </div>
  </div>

  <h2>MAWARAN CO</h2>

  <label>هل يمتلك زيت ريماكس *</label>
  <select id="useOil">
    <option value="">اختر</option>
    <option>نعم</option>
    <option>لا</option>
  </select>

  <label>الاسم التجاري *</label>
  <input id="tradeName">

  <label>اسم المالك *</label>
  <input id="ownerName">

  <label>العنوان *</label>
  <input id="address">

  <label>رقم الهاتف *</label>
  <input id="phone" inputmode="numeric">

  <label>الفئة *</label>
  <select id="category">
    <option value="">اختر</option>
    <option>كراج</option>
    <option>جملة</option>
    <option>مفرد</option>
  </select>

  <label>ملاحظة</label>
  <textarea id="note"></textarea>

  <label>التقييم *</label>
  <select id="rate">
    <option value="">اختر</option>
    <option value="1">⭐</option>
    <option value="2">⭐⭐</option>
    <option value="3">⭐⭐⭐</option>
    <option value="4">⭐⭐⭐⭐</option>
    <option value="5">⭐⭐⭐⭐⭐</option>
  </select>

  <label>كل كم يوم زيارة *</label>
  <input id="visitDays" inputmode="numeric">

  <!-- اختيارية -->
  <label>نوع الزيت</label>
  <input id="oilType">

  <label>درجة الزيت</label>
  <input id="oilGrade">

  <label>كم المسافة التي يقطعها الزيت</label>
  <select id="oilDistance">
    <option value="">اختر</option>
    <option>3 كم</option>
    <option>5 كم</option>
    <option>10 كم</option>
    <option>15 كم</option>
  </select>

  <label>سعر اللتر</label>
  <input id="oilPrice" inputmode="numeric">

  <button onclick="send()">إرسال</button>
  <div id="msg"></div>
</div>

</div>

<script>
const URL="https://script.google.com/macros/s/AKfycbwHA7OqlgtK0ozm1Ub4KXm61-qQWM6yPCiLnyt-QKM8mzfnkqKOo2C6RZuX2M2gYG37SA/exec";

if(localStorage.repName){
  login.classList.add("hidden");
  formBox.classList.remove("hidden");
  repShow.textContent=localStorage.repName;
  cityEdit.value=localStorage.city;
}

function saveLogin(){
  if(!repName.value||!city.value)return;
  localStorage.repName=repName.value;
  localStorage.city=city.value;
  location.reload();
}

function send(){
  const required=[
    useOil,tradeName,ownerName,address,
    phone,category,rate,visitDays
  ];
  let ok=true;
  required.forEach(f=>{
    f.classList.remove("error");
    if(!f.value){f.classList.add("error");ok=false;}
  });
  if(!ok)return;

  msg.textContent="جاري الإرسال...";

  navigator.geolocation.getCurrentPosition(pos=>{
    localStorage.city=cityEdit.value;

    const data={
      repName:localStorage.repName,
      city:cityEdit.value,
      tradeName:tradeName.value,
      ownerName:ownerName.value,
      useOil:useOil.value,
      address:address.value,
      phone:phone.value,
      category:category.value,
      note:note.value,
      rate:rate.value,
      visitDays:visitDays.value,
      lat:pos.coords.latitude,
      lng:pos.coords.longitude,
      oilType:oilType.value,
      oilGrade:oilGrade.value,
      oilDistance:oilDistance.value,
      oilPrice:oilPrice.value
    };

    fetch(URL,{method:"POST",body:JSON.stringify(data)})
    .then(r=>r.json())
    .then(res=>{
      if(res.status==="success"){
        msg.textContent="✅ تم الإرسال بنجاح";
        document.querySelectorAll(
          "#formBox input,#formBox textarea,#formBox select"
        ).forEach(e=>{if(e.id!=="cityEdit")e.value=""});
      }else msg.textContent="❌ "+res.message;
    });
  },()=>msg.textContent="❌ لم يتم تحديد الموقع");
}
</script>

</body>
</html>
