<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAWARAN CO</title>

<style>
body{
  font-family: Tahoma, Arial;
  background:#f2f4f7;
  margin:0;
  padding:15px;
}
.container{
  max-width:420px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}
h2{
  text-align:center;
  margin-bottom:15px;
}
input,select,textarea,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:15px;
}
button{
  background:#007bff;
  color:#fff;
  border:none;
  border-radius:6px;
}
button:disabled{
  background:#aaa;
}
.top-info{
  background:#eef3ff;
  padding:10px;
  border-radius:6px;
  font-size:14px;
  margin-bottom:10px;
}
.change{
  color:#007bff;
  cursor:pointer;
  font-size:13px;
}
.loading{
  text-align:center;
  margin-top:10px;
  color:red;
}
</style>
</head>

<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ -->
<div class="container" id="loginBox">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</h2>
  <input id="repInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
  <input id="cityInput" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
  <button onclick="saveRep()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Ø§Ù„ÙÙˆØ±Ù… -->
<div class="container" id="formBox" style="display:none;">
  
  <div class="top-info">
    ğŸ‘¤ <span id="repShow"></span> â€“ ğŸ“ <span id="cityShow"></span>
    <div class="change" onclick="changeRep()">ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</div>
  </div>

  <h2>MAWARAN CO</h2>

  <input id="trade" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ" required>
  <input id="owner" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ" required>
  <input id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required>
  <input id="phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>

  <textarea id="note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" required></textarea>

  <select id="rating" required>
    <option value="">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</option>
    <option value="1">â­</option>
    <option value="2">â­â­</option>
    <option value="3">â­â­â­</option>
    <option value="4">â­â­â­â­</option>
    <option value="5">â­â­â­â­â­</option>
  </select>

  <input id="visitDays" type="number" placeholder="Ø£ÙŠØ§Ù… Ø§Ù„Ø²ÙŠØ§Ø±Ø©" required>

  <button onclick="sendData()" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
  <div class="loading" id="loading"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxjS2P9cRJG2NCnoyRSlIBM16ut0CMCiFEHEnoeYovRf9ts_pbPHaUUXnoImfOZbMbhWg/exec";

/* Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */
function saveRep(){
  if(!repInput.value || !cityInput.value){
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©");
    return;
  }
  localStorage.setItem("repName", repInput.value.trim());
  localStorage.setItem("city", cityInput.value.trim());
  showForm();
}

/* Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ±Ù… */
function showForm(){
  loginBox.style.display="none";
  formBox.style.display="block";
  repShow.textContent = localStorage.getItem("repName");
  cityShow.textContent = localStorage.getItem("city");
}

/* ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */
function changeRep(){
  localStorage.removeItem("repName");
  localStorage.removeItem("city");
  location.reload();
}

/* Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
function sendData(){
  sendBtn.disabled=true;
  loading.textContent="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

  navigator.geolocation.getCurrentPosition(pos=>{
    const fd = new FormData();
    fd.append("rep", localStorage.getItem("repName"));
    fd.append("city", localStorage.getItem("city"));
    fd.append("trade", trade.value);
    fd.append("owner", owner.value);
    fd.append("address", address.value);
    fd.append("phone", phone.value);
    fd.append("note", note.value);
    fd.append("rating", rating.value);
    fd.append("visitDays", visitDays.value);
    fd.append("lat", pos.coords.latitude);
    fd.append("lng", pos.coords.longitude);

    fetch(SCRIPT_URL,{method:"POST",body:fd})
    .then(r=>r.text())
    .then(()=>{
      alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­");
      location.reload();
    })
    .catch(()=>{
      alert("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
      sendBtn.disabled=false;
      loading.textContent="";
    });

  },()=>{
    alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
    sendBtn.disabled=false;
    loading.textContent="";
  });
}

/* Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ */
if(localStorage.getItem("repName") && localStorage.getItem("city")){
  showForm();
}
</script>

</body>
</html>
