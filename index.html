<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MAWARAN CO</title>

<style>
body{font-family:Tahom,aArial;background:#f2f4f7;margin:0}
.container{max-width:420px;margin:auto;background:#fff;
padding:16px;border-radius:12px;box-shadow:0 4px 10px #0002}
h2{text-align:center;margin:10px 0}
label{display:block;margin-top:10px;font-weight:bold}
input,select,textarea,button{
width:100%;padding:10px;margin-top:4px;
border-radius:8px;border:1px solid #ccc;font-size:16px}
button{background:#0a7cff;color:#fff;border:0;margin-top:15px}
.hidden{display:none}
#msg{margin-top:10px;text-align:center;font-weight:bold}
</style>
</head>

<body>
<div class="container">

<!-- ===== شاشة الدخول ===== -->
<div id="login">
  <h2>تسجيل الدخول</h2>

  <label>اسم المندوب الثلاثي *</label>
  <input id="repName" required>

  <label>المدينة *</label>
  <input id="city" required>

  <button onclick="saveLogin()">دخول</button>
</div>

<!-- ===== الفورم ===== -->
<div id="form" class="hidden">
  <h2>MAWARAN CO</h2>

  <label>هل يمتلك زيت ريماكس *</label>
  <select id="useOil" required>
    <option value="">اختر</option>
    <option>نعم</option>
    <option>لا</option>
  </select>

  <label>الاسم التجاري *</label>
  <input id="tradeName" required>

  <label>اسم المالك *</label>
  <input id="ownerName" required>

  <label>العنوان *</label>
  <input id="address" required>

  <label>رقم الهاتف *</label>
  <input id="phone" type="tel" inputmode="numeric" required>

  <label>الفئة *</label>
  <select id="category" required>
    <option value="">اختر</option>
    <option>كراج</option>
    <option>جملة</option>
    <option>مفرد</option>
  </select>

  <label>ملاحظة</label>
  <textarea id="note"></textarea>

  <label>التقييم *</label>
  <select id="rate" required>
    <option value="">اختر</option>
    <option>1</option><option>2</option><option>3</option>
    <option>4</option><option>5</option>
  </select>

  <label>كل كم يوم زيارة *</label>
  <input id="visitDays" type="number" inputmode="numeric" required>

  <!-- حقول اختيارية -->
  <label>نوع الزيت</label>
  <input id="oilType">

  <label>درجة الزيت</label>
  <input id="oilGrade">

  <label>كم المسافة التي يقطعها الزيت</label>
  <select id="oilDistance">
    <option value="">اختر</option>
    <option>3 كم</option>
    <option>5 كم</option>
    <option>10 كم</option>
    <option>15 كم</option>
  </select>

  <label>سعر اللتر</label>
  <input id="oilPrice" type="number" inputmode="numeric">

  <button onclick="send()">إرسال</button>
  <div id="msg"></div>
</div>

</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbx82nb5QE3kqFNULF-7iWN5Nat9CgJERh0JdHYDUtnYT3VOl1CGLXueRWG5QtmJ25KPJw/exec";

if(localStorage.repName){
  document.getElementById("login").classList.add("hidden");
  document.getElementById("form").classList.remove("hidden");
}

function saveLogin(){
  localStorage.repName = repName.value;
  localStorage.city = city.value;
  location.reload();
}

function send(){
  const msg = document.getElementById("msg");
  msg.textContent = "جاري الإرسال...";

  navigator.geolocation.getCurrentPosition(pos=>{
    const data = {
      repName: localStorage.repName,
      city: localStorage.city,
      useOil: useOil.value,
      tradeName: tradeName.value,
      ownerName: ownerName.value,
      address: address.value,
      phone: phone.value,
      category: category.value,
      note: note.value,
      rate: rate.value,
      visitDays: visitDays.value,
      lat: pos.coords.latitude,
      lng: pos.coords.longitude,
      oilType: oilType.value,
      oilGrade: oilGrade.value,
      oilDistance: oilDistance.value,
      oilPrice: oilPrice.value
    };

    fetch(URL,{
      method:"POST",
      body:JSON.stringify(data)
    })
    .then(r=>r.json())
    .then(res=>{
      if(res.status==="success"){
        msg.textContent="✅ تم الإرسال بنجاح";
        document.querySelector("form")?.reset();
      }else{
        msg.textContent="❌ "+res.message;
      }
    })
    .catch(()=>msg.textContent="❌ فشل الاتصال");

  },()=>msg.textContent="❌ لم يتم الحصول على الموقع");
}
</script>

</body>
</html>
