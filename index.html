<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAWARAN co</title>

<style>
body{
  font-family: Tahoma, Arial;
  background:#f2f4f7;
  margin:0;
  padding:10px;
}
.container{
  max-width:430px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:14px;
  box-shadow:0 4px 15px rgba(0,0,0,.15);
}
h2,h3{text-align:center;margin:10px 0}
label{display:block;margin-top:12px;font-weight:bold}
input,select,textarea,button{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}
button{
  background:#0b5ed7;
  color:#fff;
  border:none;
  margin-top:15px;
}
button:disabled{background:#999}
.hidden{display:none}
.required::after{content:" *";color:red}
#status{margin-top:10px;font-weight:bold;text-align:center}
</style>
</head>

<body>
<div class="container">

<!-- ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø© -->
<div id="loginBox">
  <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</h3>

  <label class="required">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
  <input id="repName">

  <label class="required">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
  <input id="city">

  <button onclick="saveRep()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
<div id="formBox" class="hidden">

  <h2>MAWARAN co</h2>

  <label class="required">Ù‡Ù„ ÙŠÙ…ØªÙ„Ùƒ Ø²ÙŠØª Ø±ÙŠÙ…Ø§ÙƒØ³ØŸ</label>
  <select id="useOil">
    <option value="">Ø§Ø®ØªØ±</option>
    <option>Ù†Ø¹Ù…</option>
    <option>Ù„Ø§</option>
  </select>

  <label class="required">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label>
  <input id="tradeName">

  <label class="required">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</label>
  <input id="ownerName">

  <label class="required">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
  <input id="address">

  <label class="required">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
  <input id="phone" type="number" inputmode="numeric">

  <label class="required">Ø§Ù„ÙØ¦Ø©</label>
  <select id="category">
    <option value="">Ø§Ø®ØªØ±</option>
    <option>ÙƒØ±Ø§Ø¬</option>
    <option>Ø¬Ù…Ù„Ø©</option>
    <option>Ù…ÙØ±Ø¯</option>
  </select>

  <label class="required">Ù…Ù„Ø§Ø­Ø¸Ø©</label>
  <textarea id="note"></textarea>

  <label class="required">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
  <select id="rate">
    <option value="">Ø§Ø®ØªØ±</option>
    <option>1</option><option>2</option><option>3</option>
    <option>4</option><option>5</option>
  </select>

  <label class="required">ÙƒÙ„ ÙƒÙ… ÙŠÙˆÙ… ØªØªÙ… Ø§Ù„Ø²ÙŠØ§Ø±Ø©</label>
  <input id="visitDays" type="number" inputmode="numeric">

  <hr>

  <label>Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØª</label>
  <input id="oilType">

  <label>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø²ÙŠØª</label>
  <input id="oilGrade">

  <label>ÙƒÙ… Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ØªÙŠ ÙŠÙ‚Ø·Ø¹Ù‡Ø§ Ø§Ù„Ø²ÙŠØª</label>
  <select id="oilDistance">
    <option value="">Ø§Ø®ØªØ±</option>
    <option>3ÙƒÙ…</option>
    <option>5ÙƒÙ…</option>
    <option>10ÙƒÙ…</option>
    <option>15ÙƒÙ…</option>
  </select>

  <label>Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±</label>
  <input id="oilPrice" type="number">

  <label class="required">Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© (ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙ‚Ø·)</label>
  <input id="image" type="file" accept="image/*" capture="environment">

  <button id="sendBtn" onclick="sendData()">Ø¥Ø±Ø³Ø§Ù„</button>
  <div id="status"></div>

</div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbw5pXhCNbS13H9Fb_kjAPrsF3G0xvYJ4XemfcfzW4mjy7qwUB7CBtyYbejJ-RYcIqhxUw/exec";

function saveRep(){
  if(!repName.value || !city.value){
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©");
    return;
  }
  localStorage.setItem("repName", repName.value);
  localStorage.setItem("city", city.value);
  showForm();
}

function showForm(){
  if(localStorage.getItem("repName")){
    loginBox.classList.add("hidden");
    formBox.classList.remove("hidden");
  }
}
showForm();

async function sendData(){
  const status = document.getElementById("status");
  const btn = document.getElementById("sendBtn");

  if(!image.files.length){
    status.innerText = "âŒ ÙŠØ¬Ø¨ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©";
    return;
  }

  status.innerText = "ğŸ“¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
  btn.disabled = true;

  navigator.geolocation.getCurrentPosition(async pos=>{
    try{
      status.innerText = "ğŸ“· ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØµÙˆØ±Ø©...";
      const base64 = await toBase64(image.files[0]);

      status.innerText = "ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

      const payload = {
        repName: localStorage.getItem("repName"),
        city: localStorage.getItem("city"),
        lat: pos.coords.latitude,
        lng: pos.coords.longitude,
        useOil: useOil.value,
        tradeName: tradeName.value,
        ownerName: ownerName.value,
        address: address.value,
        phone: phone.value,
        category: category.value,
        note: note.value,
        rate: rate.value,
        visitDays: visitDays.value,
        oilType: oilType.value,
        oilGrade: oilGrade.value,
        oilDistance: oilDistance.value,
        oilPrice: oilPrice.value,
        image: base64
      };

      const res = await fetch(scriptURL,{
        method:"POST",
        body: JSON.stringify(payload)
      });

      const text = await res.text();
      if(text !== "ok") throw text;

      status.innerText = "âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­";
      btn.disabled = false;

    }catch(err){
      status.innerText = "âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + err;
      btn.disabled = false;
    }

  },()=>{
    status.innerText = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹";
    btn.disabled = false;
  });
}

function toBase64(file){
  return new Promise((resolve,reject)=>{
    const r = new FileReader();
    r.onload = ()=>resolve(r.result);
    r.onerror = reject;
    r.readAsDataURL(file);
  });
}
</script>

</body>
</html>

