<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAWARAN co</title>

<style>
body{
  font-family: Tahoma, Arial;
  background:#f2f4f7;
  margin:0;
  padding:10px;
}
.container{
  max-width:430px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:14px;
  box-shadow:0 4px 15px rgba(0,0,0,.15);
}
h2,h3{text-align:center;margin:10px 0}
label{display:block;margin-top:12px;font-weight:bold}
input,select,textarea,button{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}
button{
  background:#0b5ed7;
  color:#fff;
  border:none;
  margin-top:15px;
}
button:disabled{background:#999}
.hidden{display:none}
.required::after{content:" *";color:red}
</style>
</head>

<body>
<div class="container">

<!-- تسجيل أول مرة -->
<div id="loginBox">
  <h3>تسجيل المندوب</h3>
  <label class="required">اسم المندوب الثلاثي</label>
  <input id="repName" required>

  <label class="required">المدينة</label>
  <input id="city" required>

  <button onclick="saveRep()">دخول</button>
</div>

<!-- الفورم الرئيسي -->
<div id="formBox" class="hidden">
  <h2>MAWARAN co</h2>

  <label class="required">هل يمتلك زيت ريماكس؟</label>
  <select id="useOil" required>
    <option value="">اختر</option>
    <option>نعم</option>
    <option>لا</option>
  </select>

  <label class="required">الاسم التجاري</label>
  <input id="tradeName" required>

  <label class="required">اسم المالك</label>
  <input id="ownerName" required>

  <label class="required">العنوان</label>
  <input id="address" required>

  <label class="required">رقم الهاتف</label>
  <input id="phone" type="number" inputmode="numeric" required>

  <label class="required">الفئة</label>
  <select id="category" required>
    <option value="">اختر</option>
    <option>كراج</option>
    <option>جملة</option>
    <option>مفرد</option>
  </select>

  <label class="required">ملاحظة</label>
  <textarea id="note" required></textarea>

  <label class="required">التقييم</label>
  <select id="rate" required>
    <option value="">اختر</option>
    <option>1</option><option>2</option><option>3</option>
    <option>4</option><option>5</option>
  </select>

  <label class="required">كل كم يوم تتم الزيارة</label>
  <input id="visitDays" type="number" inputmode="numeric" required>

  <hr>

  <label>نوع الزيت</label>
  <input id="oilType">

  <label>درجة الزيت</label>
  <input id="oilGrade">

  <label>كم المسافة التي يقطعها الزيت</label>
  <select id="oilDistance">
    <option value="">اختر</option>
    <option>3كم</option>
    <option>5كم</option>
    <option>10كم</option>
    <option>15كم</option>
  </select>

  <label>سعر اللتر</label>
  <input id="oilPrice" type="number">

  <label class="required">صورة (من الكاميرا فقط)</label>
  <input id="image" type="file" accept="image/*" capture="environment" required>

  <button id="sendBtn" onclick="sendData()">إرسال</button>
  <p id="status"></p>
</div>

</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzrn3hVCuPDvx2XZwyzyI3_p5pTYu_HcSb-WCAXlLvuEJ8OR8wQ6K6VxWXz78035l2Aww/exec";

function saveRep(){
  localStorage.setItem("repName", repName.value);
  localStorage.setItem("city", city.value);
  showForm();
}

function showForm(){
  if(localStorage.getItem("repName")){
    loginBox.classList.add("hidden");
    formBox.classList.remove("hidden");
  }
}

showForm();

function sendData(){
  sendBtn.disabled = true;
  status.innerText = "جاري الإرسال...";

  navigator.geolocation.getCurrentPosition(pos=>{
    const fd = new FormData();
    fd.append("repName", localStorage.getItem("repName"));
    fd.append("city", localStorage.getItem("city"));
    fd.append("lat", pos.coords.latitude);
    fd.append("lng", pos.coords.longitude);

    ["useOil","tradeName","ownerName","address","phone","category",
     "note","rate","visitDays","oilType","oilGrade",
     "oilDistance","oilPrice"].forEach(id=>{
       fd.append(id, document.getElementById(id).value);
     });

    fd.append("image", image.files[0]);

    fetch(scriptURL,{method:"POST",body:fd})
    .then(()=>{status.innerText="تم الإرسال بنجاح";sendBtn.disabled=false})
    .catch(()=>{status.innerText="خطأ";sendBtn.disabled=false});
  });
}
</script>

</body>
</html>
