<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAWARAN co</title>

<style>
body{
  font-family: Tahoma, Arial;
  background:#f2f4f7;
  margin:0;
  padding:10px;
}
.container{
  max-width:430px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:14px;
  box-shadow:0 4px 15px rgba(0,0,0,.15);
}
h2,h3{text-align:center}
label{display:block;margin-top:12px;font-weight:bold}
input,select,textarea,button{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  background:#0b5ed7;
  color:#fff;
  border:none;
  margin-top:15px;
}
button:disabled{background:#999}
.hidden{display:none}
.required::after{content:" *";color:red}
#status{text-align:center;margin-top:10px;font-weight:bold}
</style>
</head>

<body>
<div class="container">

<div id="loginBox">
  <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</h3>
  <label class="required">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
  <input id="repName">
  <label class="required">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
  <input id="city">
  <button onclick="saveRep()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="formBox" class="hidden">
<h2>MAWARAN co</h2>

<label class="required">Ù‡Ù„ ÙŠÙ…ØªÙ„Ùƒ Ø²ÙŠØª Ø±ÙŠÙ…Ø§ÙƒØ³</label>
<select id="useOil"><option value="">Ø§Ø®ØªØ±</option><option>Ù†Ø¹Ù…</option><option>Ù„Ø§</option></select>

<label class="required">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label>
<input id="tradeName">

<label class="required">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</label>
<input id="ownerName">

<label class="required">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
<input id="address">

<label class="required">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
<input id="phone" type="number" inputmode="numeric">

<label class="required">Ø§Ù„ÙØ¦Ø©</label>
<select id="category"><option value="">Ø§Ø®ØªØ±</option><option>ÙƒØ±Ø§Ø¬</option><option>Ø¬Ù…Ù„Ø©</option><option>Ù…ÙØ±Ø¯</option></select>

<label class="required">Ù…Ù„Ø§Ø­Ø¸Ø©</label>
<textarea id="note"></textarea>

<label class="required">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
<select id="rate"><option value="">Ø§Ø®ØªØ±</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

<label class="required">ÙƒÙ„ ÙƒÙ… ÙŠÙˆÙ… ØªØªÙ… Ø§Ù„Ø²ÙŠØ§Ø±Ø©</label>
<input id="visitDays" type="number">

<hr>

<label>Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØª</label><input id="oilType">
<label>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø²ÙŠØª</label><input id="oilGrade">
<label>Ø§Ù„Ù…Ø³Ø§ÙØ©</label>
<select id="oilDistance"><option value="">Ø§Ø®ØªØ±</option><option>3ÙƒÙ…</option><option>5ÙƒÙ…</option><option>10ÙƒÙ…</option><option>15ÙƒÙ…</option></select>
<label>Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±</label><input id="oilPrice" type="number">

<label class="required">Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©</label>
<input id="image" type="file" accept="image/*" capture="environment">

<button id="sendBtn" onclick="sendData()">Ø¥Ø±Ø³Ø§Ù„</button>
<div id="status"></div>
</div>

</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwrge2UK7G5TtpXRu3CmRmwvjTtoGzj55TxvyO-uBPlovtLRPLWarPPgraIedv2IOXOag/exec";

function saveRep(){
  localStorage.setItem("repName",repName.value);
  localStorage.setItem("city",city.value);
  loginBox.classList.add("hidden");
  formBox.classList.remove("hidden");
}

if(localStorage.getItem("repName")){
  loginBox.classList.add("hidden");
  formBox.classList.remove("hidden");
}

function toBase64(file){
  return new Promise(r=>{
    const f=new FileReader();
    f.onload=()=>r(f.result);
    f.readAsDataURL(file);
  });
}

function sendData(){
  const btn=sendBtn;
  const status=document.getElementById("status");
  if(!image.files.length){status.innerText="âŒ Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø©";return;}

  btn.disabled=true;
  status.innerText="ğŸ“¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";

  navigator.geolocation.getCurrentPosition(async pos=>{
    status.innerText="ğŸ“· ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØµÙˆØ±Ø©...";
    const img=await toBase64(image.files[0]);

    status.innerText="ğŸ“¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
    const res=await fetch(scriptURL,{
      method:"POST",
      body:JSON.stringify({
        repName:localStorage.repName,
        city:localStorage.city,
        lat:pos.coords.latitude,
        lng:pos.coords.longitude,
        useOil:useOil.value,
        tradeName:tradeName.value,
        ownerName:ownerName.value,
        address:address.value,
        phone:phone.value,
        category:category.value,
        note:note.value,
        rate:rate.value,
        visitDays:visitDays.value,
        oilType:oilType.value,
        oilGrade:oilGrade.value,
        oilDistance:oilDistance.value,
        oilPrice:oilPrice.value,
        image:img
      })
    });

    const t=await res.text();
    status.innerText = t==="ok" ? "âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„" : "âŒ "+t;
    btn.disabled=false;
  });
}
</script>
</body>
</html>

