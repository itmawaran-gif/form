<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAWARAN CO</title>

<style>
body{
  font-family: Tahoma, Arial;
  background:#f2f4f7;
  margin:0;
  padding:15px;
}
.container{
  max-width:420px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
}
h2{text-align:center;margin-bottom:10px;}
input,select,textarea,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:15px;
  border-radius:6px;
  border:1px solid #ccc;
}
textarea{resize:none;}
button{
  background:#007bff;
  color:#fff;
  border:none;
}
button:disabled{background:#aaa;}
.info{
  background:#eef3ff;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
  font-size:14px;
  text-align:center;
}
.loading{
  text-align:center;
  margin-top:10px;
  color:#d00;
}
.preview{
  margin-top:10px;
  text-align:center;
}
.preview img{
  max-width:100%;
  border-radius:8px;
}
</style>
</head>

<body>

<div class="container" id="loginBox">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</h2>
  <input id="repInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
  <input id="cityInput" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
  <button onclick="saveRep()">ØªØ³Ø¬ÙŠÙ„</button>
</div>

<div class="container" id="formBox" style="display:none;">
  <div class="info">
    ğŸ‘¤ <b id="repShow"></b> | ğŸ“ <b id="cityShow"></b>
  </div>

  <h2>MAWARAN CO</h2>

  <select id="useOil">
    <option value="">Ù‡Ù„ ÙŠØ³ØªØ®Ø¯Ù… Ø²ÙŠØªØŸ</option>
    <option value="Ù†Ø¹Ù…">Ù†Ø¹Ù…</option>
    <option value="Ù„Ø§">Ù„Ø§</option>
  </select>

  <input id="trade" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ">
  <input id="owner" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ">
  <input id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">

  <select id="category">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
    <option value="ÙƒØ±Ø§Ø¬">ÙƒØ±Ø§Ø¬</option>
    <option value="Ø¬Ù…Ù„Ø©">Ø¬Ù…Ù„Ø©</option>
    <option value="Ù…ÙØ±Ø¯">Ù…ÙØ±Ø¯</option>
  </select>

  <textarea id="note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>

  <select id="rating">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</option>
    <option value="1">â­</option>
    <option value="2">â­â­</option>
    <option value="3">â­â­â­</option>
    <option value="4">â­â­â­â­</option>
    <option value="5">â­â­â­â­â­</option>
  </select>

  <input id="visitDays" type="number" placeholder="Ø£ÙŠØ§Ù… Ø§Ù„Ø²ÙŠØ§Ø±Ø©">
  <input id="oilType" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØª">
  <input id="oilGrade" placeholder="Ø¯Ø±Ø¬Ø© Ø§Ù„Ø²ÙŠØª">

  <select id="distance">
    <option value="">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©</option>
    <option value="3 ÙƒÙ…">3 ÙƒÙ…</option>
    <option value="5 ÙƒÙ…">5 ÙƒÙ…</option>
    <option value="10 ÙƒÙ…">10 ÙƒÙ…</option>
    <option value="15 ÙƒÙ…">15 ÙƒÙ…</option>
  </select>

  <input id="price" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±">

  <input id="imageInput" type="file" accept="image/*" capture="environment">
  <div class="preview" id="preview"></div>

  <button id="sendBtn" onclick="sendData()">Ø¥Ø±Ø³Ø§Ù„</button>
  <div class="loading" id="loading"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxAV7VujFsbK0rZW18_1UO_mp_W2U-h2OI7Eu-SwD6MXABjq3rHM954BI6T94lOuYaIGQ/exec";
let imageBase64 = "";

/* ØªØ³Ø¬ÙŠÙ„ */
function saveRep(){
  if(!repInput.value || !cityInput.value){
    alert("Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¥Ù„Ø²Ø§Ù…ÙŠØ©");
    return;
  }
  localStorage.setItem("repName", repInput.value);
  localStorage.setItem("city", cityInput.value);
  showForm();
}

function showForm(){
  loginBox.style.display="none";
  formBox.style.display="block";
  repShow.textContent = localStorage.getItem("repName");
  cityShow.textContent = localStorage.getItem("city");
}

/* ØµÙˆØ±Ø© */
imageInput.addEventListener("change", ()=>{
  const file = imageInput.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = ()=>{
    const img = new Image();
    img.src = reader.result;
    img.onload = ()=>{
      const canvas = document.createElement("canvas");
      const scale = 800 / img.width;
      canvas.width = 800;
      canvas.height = img.height * scale;
      canvas.getContext("2d").drawImage(img,0,0,canvas.width,canvas.height);
      imageBase64 = canvas.toDataURL("image/jpeg",0.6);
      preview.innerHTML = `<img src="${imageBase64}">`;
    };
  };
  reader.readAsDataURL(file);
});

/* Ø¥Ø±Ø³Ø§Ù„ */
function sendData(){
  if(!imageBase64){
    alert("Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ø²Ø§Ù…ÙŠØ©");
    return;
  }

  sendBtn.disabled=true;
  loading.textContent="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

  navigator.geolocation.getCurrentPosition(pos=>{

    const data = new URLSearchParams({
      rep: localStorage.getItem("repName"),
      city: localStorage.getItem("city"),
      trade: trade.value,
      owner: owner.value,
      address: address.value,
      phone: phone.value,
      category: category.value,
      note: note.value,
      rating: rating.value,
      visitDays: visitDays.value,
      useOil: useOil.value,
      oilType: oilType.value,
      oilGrade: oilGrade.value,
      distance: distance.value,
      price: price.value,
      lat: pos.coords.latitude,
      lng: pos.coords.longitude,
      imageBase64: imageBase64
    });

    fetch(SCRIPT_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/x-www-form-urlencoded" },
      body:data.toString()
    })
    .then(()=>{ alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­"); location.reload(); })
    .catch(()=>{
      alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
      sendBtn.disabled=false;
      loading.textContent="";
    });
  });
}

if(localStorage.getItem("repName") && localStorage.getItem("city")){
  showForm();
}
</script>

</body>
</html>
